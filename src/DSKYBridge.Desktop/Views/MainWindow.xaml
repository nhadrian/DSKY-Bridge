<Window x:Class="DSKYBridge.MainWindow"
       xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
       xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
       xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
       xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
       xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
       mc:Ignorable="d"
       Title="DSKY-Bridge"
       Width="800"
       Height="500"
       MinWidth="400"
       MinHeight="250"
       ResizeMode="CanResize"
       Topmost="True"
       WindowStyle="None"
       Background="Transparent"
       WindowStartupLocation="CenterScreen"
       AllowsTransparency="True"
       Icon="pack://application:,,,/Assets/DSKY.ico"
       SnapsToDevicePixels="True">

       <!-- Borderless resizing support -->
       <shell:WindowChrome.WindowChrome>
              <shell:WindowChrome CaptionHeight="0"
                     ResizeBorderThickness="6"
                     CornerRadius="0"
                     GlassFrameThickness="0"
                     UseAeroCaptionButtons="False" />
       </shell:WindowChrome.WindowChrome>

       <Window.Resources>
              <!-- Template to suppress default hover visuals -->
              <ControlTemplate x:Key="NoMouseOverButtonTemplate" TargetType="Button">
                     <Border Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                   VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                     </Border>
              </ControlTemplate>

              <!-- Hitbox buttons: Transparent background for reliable hit testing -->
              <Style x:Key="HitBoxButtonStyle" TargetType="{x:Type Button}">
                     <Setter Property="Template" Value="{StaticResource NoMouseOverButtonTemplate}" />
              <!--       <Setter Property="Background" Value="#40FF0000" /> -->
                     <Setter Property="Background" Value="Transparent" />
              <!--       <Setter Property="BorderBrush" Value="#00000000" /> -->
                     <Setter Property="BorderThickness" Value="1" />
                     <Setter Property="BorderThickness" Value="0" />
                     <Setter Property="Focusable" Value="False" />

                     <!-- Keypad press shadow effect (applies to functional hitboxes like Verb/Noun/etc.) -->
                     <EventSetter Event="PreviewMouseLeftButtonDown" Handler="FunctionalButton_MouseDown" />
                     <EventSetter Event="PreviewMouseLeftButtonUp" Handler="FunctionalButton_MouseUp" />
                     <EventSetter Event="MouseLeave" Handler="FunctionalButton_MouseLeave" />
              </Style>

              <!-- Icon buttons: DO NOT set Background here (so Button.Background can be set in XAML) -->
              <Style x:Key="IconButtonStyle" TargetType="{x:Type Button}">
                     <Setter Property="Template" Value="{StaticResource NoMouseOverButtonTemplate}" />
                     <Setter Property="BorderBrush" Value="#00000000" />
                     <Setter Property="BorderThickness" Value="0" />
                     <Setter Property="Focusable" Value="False" />
                     <Setter Property="Background" Value="Transparent" />
              </Style>

              <!-- Hover-only icon (invisible until hovered) -->
              <Style x:Key="HoverOnlyIconButtonStyle" TargetType="{x:Type Button}" BasedOn="{StaticResource IconButtonStyle}">
                     <Setter Property="Opacity" Value="0" />
                     <Setter Property="Cursor" Value="Hand" />
                     <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                   <Setter Property="Opacity" Value="1" />
                            </Trigger>
                     </Style.Triggers>
              </Style>
       </Window.Resources>

       <!-- proportional scaling after launch -->
       <Viewbox Stretch="Uniform" StretchDirection="Both">
              <!-- SINGLE coordinate space -->
              <Grid x:Name="RootGrid" Width="800" Height="500">
                     <!-- Background image (same coordinate space as hitboxes) -->
                     <Border SnapsToDevicePixels="True">
                            <Grid>
                                   <Grid.RowDefinitions>
                                          <!-- Header image height can be Auto (image’s natural height) -->
                                          <RowDefinition Height="Auto"/>
                                          <!-- Middle area eats all remaining space -->
                                          <RowDefinition Height="*"/>
                                          <!-- Footer image -->
                                          <RowDefinition Height="Auto"/>
                                   </Grid.RowDefinitions>

                                   <!-- HEADER -->
                                   <Image Grid.Row="0"
                                          Source="pack://application:,,,/Assets/Images/background_header.png"
                                          Stretch="Fill"
                                          IsHitTestVisible="False"/>

                                   <!-- MIDDLE FILL -->
                                   <Rectangle Grid.Row="1"
                                          Fill="#FF7f8484"
                                          IsHitTestVisible="False"/>

                                   <!-- FOOTER -->
                                   <Image Grid.Row="2"
                                          Source="pack://application:,,,/Assets/Images/background_footer.png"
                                          Stretch="Fill"
                                          IsHitTestVisible="False"/>
                            </Grid>
                     </Border>

                     <!-- Header label -->
                     <Label x:Name="Header" Content="EXTERNAL DSKY REENTRY BRIDGE" Margin="120, 10,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Foreground="#FFFFFFFF" FontSize="28" FontFamily="pack://application:,,,/Assets/Fonts/#Gorton" Width="800" Panel.ZIndex="5"/>

                     <!-- Local IP Address -->
                     <Label x:Name="LocalIP" Content="000 000 000 000" Margin="50, 155,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Foreground="#FF03A95A" FontSize="54" FontFamily="pack://application:,,,/Assets/Fonts/#Zerlina" Width="600" Panel.ZIndex="5"/>

                     <!-- Local IP LCD background image -->
                     <Image x:Name="LocalLCD" Height="158" Width="570" Stretch="Fill" Margin="18, 87,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lcd_local.png"
                            Panel.ZIndex="2" IsHitTestVisible="False" Visibility="Visible"/>

                     <Grid x:Name="ReentryIndicator" Visibility="Visible" Panel.ZIndex="2" Margin="590,75,0,0" HorizontalAlignment="Left" VerticalAlignment="Top">
                            <Image x:Name="ReentryIndBack" Height="192" Width="192" Stretch="Fill" Margin="0,0,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                                   Source="pack://application:,,,/Assets/Images/link_ind_back.png"
                                   Panel.ZIndex="1" IsHitTestVisible="False" Visibility="Visible"/>

                            <Image x:Name="UpLink" Height="31" Width="31" Stretch="Fill" Margin="47,93,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                                   Source="pack://application:,,,/Assets/Images/ind_error.png"
                                   Panel.ZIndex="2" IsHitTestVisible="False" Visibility="Visible"/>

                            <Image x:Name="DownLink" Height="31" Width="31" Stretch="Fill" Margin="115,93,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                                   Source="pack://application:,,,/Assets/Images/ind_error.png"
                                   Panel.ZIndex="2" IsHitTestVisible="False" Visibility="Visible"/>
                     </Grid>

                     <Grid x:Name="DskyControl1" Visibility="Visible" Panel.ZIndex="2" Margin="0,280,0,0" HorizontalAlignment="Left" VerticalAlignment="Top">
                            <!-- DSKY IP address -->
                            <Label x:Name="DskyIP" Content="000 000 000 000" Margin="50, 68,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" 
                                   Foreground="#FF03A95A" FontSize="54" FontFamily="pack://application:,,,/Assets/Fonts/#Zerlina" Width="600" Panel.ZIndex="5"/>

                            <!-- LCD background image -->
                            <Image x:Name="LCD" Height="158" Width="570" Stretch="Fill" Margin="18, 0,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                                   Source="pack://application:,,,/Assets/Images/lcd.png"
                                   Panel.ZIndex="2" IsHitTestVisible="False" Visibility="Visible"/>

                            <!-- Switch background image -->
                            <Image x:Name="SwCase" Height="190" Width="190" Stretch="Fill" Margin="588,0,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                                   Source="pack://application:,,,/Assets/Images/switch_case.png"
                                   Panel.ZIndex="2" IsHitTestVisible="False" Visibility="Visible"/>

                            <!-- Switch image -->
                            <Image x:Name="SwArm" Height="190" Width="84" Stretch="Fill" Margin="621,0,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                                   Source="pack://application:,,,/Assets/Images/switch_ctr.png"
                                   Panel.ZIndex="3" IsHitTestVisible="False" Visibility="Visible"/>

                            <!-- Hitbox buttons (ON TOP of everything) -->
                            <Button x:Name="SwUp"   Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                                   Margin="607,18,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="165" Height="44"
                                   Click="SwUp_Click"/>

                            <Button x:Name="SwCtr"   Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                                   Margin="607,71,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="165" Height="44"
                                   Click="SwCtr_Click"/>

                            <Button x:Name="SwDn"   Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                                   Margin="607,123,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="165" Height="44"
                                   Click="SwDn_Click"/>
                     </Grid>

                     <!-- Close button: top-right, only visible when hovered -->
                     <Button x:Name="CloseButton" Style="{StaticResource HoverOnlyIconButtonStyle}" Panel.ZIndex="50"
                            Margin="747,16,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="36" Height="36"
                            Click="CloseButton_Click">
                            <Button.Background>
                                   <ImageBrush ImageSource="pack://application:,,,/Assets/Images/close.png" Stretch="Uniform"/>
                            </Button.Background>
                     </Button>
              </Grid>
       </Viewbox>
</Window>
